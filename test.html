<html>
    <head>
        <script src="http://code.jquery.com/jquery-3.2.1.min.js"
                integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
                crossorigin="anonymous"></script>
        <script src="http://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
                integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="
                crossorigin="anonymous"></script>
        <link rel="stylesheet" href="http://code.jquery.com/ui/1.12.1/themes/humanity/jquery-ui.css" />

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

        <link rel="stylesheet" href="jsonview.css" />
        <!--<link rel="stylesheet" href="pgrid.css" />-->
        <script type="text/javascript" src="jsonview.js"></script>
        <script type="text/javascript" src="pgrid.js"></script>

        <script type="text/javascript" src="http://www.chartjs.org/dist/2.6.0/Chart.bundle.js"></script>
        <script type="text/javascript" src="jsonview.extra.js"></script>
    </head>
    <body>
        <div id="template" class="panel panel-default" style="display: none;">
            <div class="panel-heading"><h3>TITLE</h3></div>
            <div class="panel-body">
                <table class="table">
                    <tr id="header">
                        <td id="source" style="width: 50%">
                            <ul class="nav nav-tabs" role="tablist">
                                <li role="presentation" class="active"><a href="#original" aria-controls="original" role="tab" data-toggle="tab">Original</a></li>
                                <li role="presentation"><a href="#parsed" aria-controls="parsed" role="tab" data-toggle="tab">Parsed</a></li>
                                <li role="presentation"><a href="#view" aria-controls="view" role="tab" data-toggle="tab">View Tree</a></li>
                            </ul>
                            <div class="tab-content">
                                <div role="tabpanel" class="tab-pane active" id="original"></div>
                                <div role="tabpanel" class="tab-pane" id="parsed"></div>
                                <div role="tabpanel" class="tab-pane" id="view"></div>
                            </div>
                        </td>
                        <td style="width: 50%">
                            <ul class="nav nav-tabs" role="tablist">
                                <li role="presentation" class="active"><a href="#gigi" aria-controls="gigi" role="tab" data-toggle="tab">Output</a></li>
                            </ul>
                            <div class="tab-content">
                                <div role="tabpanel" class="tab-pane active" id="gigi"></div>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <script type="text/javascript">
            var x = [
                {
                    title: 'No Metadata',
                    data: {
                        mihaitza: 5,
                        costelush: 'test'
                    }
                },
                {
                    title: "Forcing 'Number' property to be displayed as 'String'",
                    data: {
                        _mihaitzaInfo: { viewKey: 'string' },
                        mihaitza: 5,
                        costelush: 'test'
                    }
                },
                {
                    title: 'Categories',
                    data: {
                        _mihaitzaInfo: { category: 'Numbers' },
                        _costelushInfo: { category: 'Strings' },
                        mihaitza: 5,
                        costelush: 'test'
                    }
                },
                {
                    title: 'Category Metadata',
                    data: {
                        _metadata: {
                            _info: {
                                categoriesInfo: {
                                    'Strings': 'table'
                                }
                            }
                        },
                        _mihaitzaInfo: { category: 'Numbers' },
                        _costelushInfo: { category: 'Strings' },
                        _gigelInfo: { category: 'Strings' },
                        mihaitza: 5,
                        costelush: 'test',
                        gigel: 'This is Gigi!'
                    }
                },
                {
                    title: 'Nested Objects',
                    data: {
                        mihaitza: 5,
                        costelush: {
                            gigi: 'test',
                            gigel: 42
                        }
                    }
                },
                {
                    title: 'Nested Categories',
                    data: {
                        _mihaitzaInfo: { category: 'A' },
                        mihaitza: 5,
                        costelush: {
                            _gigiInfo: { category: 'A' },
                            _gigelInfo: { category: ['_', 'B'] },
                            _gicutzaInfo: { category: ['B'] },
                            _testInfo: { category: '_.A' },
                            gigi: 'test',
                            gigel: 42,
                            gicutza: 'testy',
                            test: 425
                        }
                    }
                },
                {
                    title: 'BIG THINGY',
                    data: {
                        test1: 5,
                        test2: 'mihaitza',
                        'null': null,
                        _fake: 425,
                        __really_fake: 425,
                        test3: {
                            _metadata: {
                                a: {
                                    label: 'costelush',
                                    category: 'GIGI'
                                },
                                b: {
                                    label: 'mihaitza'
                                },
                                e: {
                                    label: 'fake boolean',
                                    viewKey: 'boolean',
                                    category: 'GIGI'
                                },
                                c: {
                                    category: ['GIGI']
                                }
                            },
                            a: 42,
                            b: '425',
                            xxx: {
                                _metadata: {
                                    _info: {
                                        layoutKey: 'table'
                                    }
                                },
                                costel: 'mihaitza',
                                mihaitza: 'costel'
                            },
                            c: false,
                            d: function () { alert("Gigi was here!"); },
                            e: 5
                        },
                        _test3Info: {
                            index: -1
                        },
                        test4: function (thing) { alert('Gigi and ' + thing + ' were here!'); },
                        test5: [2, 4, 1, 7, 5],
                        _test5Info: {
                            viewKey: 'array-list'
                        },
                        test6: [2, 4, 1, 7, 5],
                        _test6Info: {
                            viewKey: 'array-table'
                        },
                        test7: [2, 4, 1, 7, 5],
                        _test7Info: {
                            viewKey: 'array-chart',
                            data: {
                                width: 175,
                                height: 100
                            }
                        }
                    }
                }
            ];

            var jsonConfig = {
                filterKeys: ['chartJS'],
                dataInfoProviderKeys: [],
                entityInfoProviderKeys: [],
                categoryLayoutKey: 'json'
            };

            x.forEach(function (xx) {
                var container = $('#template').clone();

                var view = net.ndrei.json.JSONView.create(container.find('#gigi'), xx.data);
                // $('<pre />').text(JSON.stringify(xx.data, function(k, v) {
                //     if ($.isFunction(v)) {
                //         return '<function>';
                //     }
                //     return v;
                // }, 2)).appendTo(container.find('#mihaitza'));
                net.ndrei.json.JSONView.create(container.find('#original'), xx.data, jsonConfig);

                // $('<pre />')
                //     .text(JSON.stringify(view.context.rootEntityInfo, null, 2))
                //     .appendTo(container.find('#costelush'));
                net.ndrei.json.JSONView.create(container.find('#parsed'), view.context.rootEntityInfo, jsonConfig);

                // $('<pre />')
                //     .text(JSON.stringify(view.viewTree.root, null, 2))
                //     .appendTo(container.find('#thingy'));
                net.ndrei.json.JSONView.create(container.find('#view'), view.viewTree.root, jsonConfig);

                container.find('.panel-heading > h3').text(xx.title);
                $('#template').parent().append(container);
                container.show();

                container.on('click', 'ul.nav-tabs a', function (e) {
                    e.preventDefault()
                    var tab = $(this).attr('href');
                    tab = tab.substr(tab.lastIndexOf('#') + 1);

                    container.find('#source div.tab-content > div').removeClass('active');
                    container.find('#source div.tab-content > div#' + tab).addClass('active');
                })
            });
        </script>
    </body>
</html>
